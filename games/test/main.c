#include "GameEngine.h"

unsigned char floor1[] = {
    0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x33, 0x33, 0x13, 0x33, 0x33, 0x31, 0x33, 0x33, 0x33, 0x33, 0x33,
    0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x31, 0x33, 0x33,
    0x33, 0xf3, 0xf3, 0x33, 0x33, 0x13, 0x33, 0x33, 0x33, 0xff, 0xf3, 0x33, 0x33, 0x33, 0x33, 0x33, 0x1f, 0xf9, 0x9f,
    0x33, 0x13, 0x33, 0x3f, 0xf1, 0xff, 0x9f, 0xff, 0x31, 0xf3, 0x33, 0xff, 0xff, 0xff, 0xf9, 0xf9, 0x3f, 0xf3, 0x33,
    0xff, 0xff, 0xff, 0xff, 0xff, 0x9f, 0xff, 0x31, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x31, 0xff, 0xf9, 0xff,
    0xff, 0xff, 0xff, 0xff, 0x1f, 0xff, 0x9f, 0x9f, 0xff, 0xff, 0xf9, 0xff, 0xff, 0xff, 0xf9, 0xff, 0x9f, 0xff, 0x9f,
    0x9f, 0xff, 0xff, 0xff, 0xf9, 0xf9, 0xff, 0xf9, 0xff, 0xff, 0xff, 0xff, 0xff, 0x9f};
unsigned char floor2[] = {
    0xff, 0xff, 0x9f, 0xff, 0xff, 0xff, 0xff, 0x9f, 0xff, 0xf9, 0xf9, 0xff, 0xff, 0xff, 0xf9, 0xf9, 0xff, 0xff, 0x9f,
    0xff, 0xff, 0xff, 0xff, 0x9f, 0xff, 0xff, 0xff, 0xff, 0xf9, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x9f, 0x9f,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf9, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf9, 0x9f,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x9f, 0xff, 0x9f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf9, 0xf9, 0xf9, 0xff, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xff, 0x9f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf9, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x9f, 0x9f, 0xff, 0xff, 0xf9, 0xff, 0xff, 0xff, 0xf9, 0xff, 0x9f, 0xff, 0x9f,
    0x9f, 0xff, 0xff, 0xff, 0xf9, 0xf9, 0xff, 0xf9, 0xff, 0xff, 0xff, 0xff, 0xff, 0x9f};
unsigned char wall1[] = {
    0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0xcc, 0x1c, 0x11, 0x11, 0x11, 0x11, 0x11, 0xc1, 0xcc, 0xc1, 0x9c,
    0xc1, 0x1c, 0xc1, 0xc9, 0xcc, 0xcc, 0xcc, 0x9c, 0xcc, 0xcc, 0xcc, 0x19, 0xcc, 0xcc, 0xcc, 0x9c, 0xcc, 0xcc, 0xcc,
    0xc9, 0xcc, 0xcc, 0xcc, 0x9c, 0xcc, 0xcc, 0xcc, 0xc9, 0xcc, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0xcc,
    0xcc, 0x1c, 0x1c, 0x9c, 0xcc, 0x1c, 0x19, 0xcc, 0xcc, 0xc1, 0xc1, 0x9c, 0xcc, 0xc1, 0xc9, 0xcc, 0xcc, 0xcc, 0x1c,
    0x9c, 0xcc, 0xcc, 0x19, 0xcc, 0xcc, 0xcc, 0xcc, 0x9c, 0xcc, 0xcc, 0xc9, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99,
    0x99, 0xc1, 0xc9, 0xcc, 0xcc, 0xc1, 0xc1, 0x9c, 0xcc, 0xcc, 0x19, 0xcc, 0xcc, 0xcc, 0x1c, 0x9c, 0xcc, 0xcc, 0xc9,
    0xcc, 0xcc, 0xcc, 0xc1, 0x9c, 0xcc, 0xcc, 0xc9, 0xcc, 0xcc, 0xcc, 0xcc, 0x9c, 0xcc};

// 20 x 8
unsigned char level0[] = {
    2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0,
    0, 0, 0, 0, 3, 3, 3, 3, 0, 0, 0, 3, 3, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 3, 0, 0, 2, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 1, 2, 1, 1, 1, 1, 1,
    2, 2, 1, 1, 1, 1, 2, 2, 2, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
};

// 8x12
unsigned char person[] = {0x00, 0xaa, 0x00, 0x00, 0x0a, 0xaa, 0xa0, 0x00, 0xaa, 0xaa, 0xa0, 0x00, 0xa1, 0x61,
                          0x60, 0x00, 0xaa, 0x11, 0x10, 0x00, 0x08, 0x77, 0x00, 0x00, 0x87, 0x77, 0x70, 0x00,
                          0x77, 0xbb, 0xbb, 0xbb, 0x7b, 0xb7, 0x07, 0x10, 0x01, 0x77, 0x00, 0x00, 0x07, 0x07,
                          0x00, 0x00, 0x08, 0x08, 0x00, 0x00, 0x00, 0xaa, 0x00, 0x00, 0x0a, 0xaa, 0xa0, 0x00,
                          0xaa, 0xaa, 0xa0, 0x00, 0xa1, 0x61, 0x60, 0x00, 0xa1, 0x11, 0x10, 0x00, 0x08, 0x77,
                          0x00, 0x00, 0x87, 0x77, 0x70, 0x00, 0x77, 0x77, 0x07, 0x00, 0x71, 0xbb, 0xbb, 0xbb,
                          0x0b, 0x77, 0x00, 0x10, 0x07, 0x00, 0x70, 0x00, 0x80, 0x00, 0x80, 0x00};

void game_main() {
    loadImage(person, 0, sizeof(person));
    loadImage(floor1, 1000, sizeof(floor1));
    loadImage(floor2, 1000 + 128, sizeof(floor2));
    loadImage(wall1, 1000 + 256, sizeof(wall1));

    Sprite sprite = {
        .address       = 0,
        .imageh        = 12,
        .imagew        = 8,
        .left          = 0,
        .right         = 6,
        .top           = 0,
        .bottom        = 12,
        .collision     = 3,
        .x             = 50,
        .y             = 10,
        .accelerationy = 1,
        .imageidx      = 0,
    };

    TileMap tilemap = {.address   = 1000,
                       .mapw      = 20,
                       .maph      = 8,
                       .map       = level0,
                       .collision = level0,
                       .imageh    = 16,
                       .imagew    = 16,
                       .x         = 0,
                       .y         = 0};

    loadTileMap(&tilemap);
    loadSprite(&sprite);

    setFramerate(25);
    while (1) {
        unsigned char key = getKey();

        if (key & KEY_RIGHT) {
            sprite.speedx   = 2;
            sprite.imageidx = 1 - sprite.imageidx;
        } else if (key & KEY_LEFT)
            sprite.speedx = -2;
        else
            sprite.speedx = 0;

        if (key & KEY_UP)
            sprite.speedy = -5;

        gameTick();

        screenRoll(-sprite.speedx, 0);
    }
}

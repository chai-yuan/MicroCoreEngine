#include "GameEngine.h"
#include "bg.img.h"
#include "person.img.h"
#include "person_run.img.h"

unsigned char floor1[] = {
    0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x33, 0x33, 0x13, 0x33, 0x33, 0x31, 0x33, 0x33, 0x33, 0x33, 0x33,
    0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x31, 0x33, 0x33,
    0x33, 0xf3, 0xf3, 0x33, 0x33, 0x13, 0x33, 0x33, 0x33, 0xff, 0xf3, 0x33, 0x33, 0x33, 0x33, 0x33, 0x1f, 0xf9, 0x9f,
    0x33, 0x13, 0x33, 0x3f, 0xf1, 0xff, 0x9f, 0xff, 0x31, 0xf3, 0x33, 0xff, 0xff, 0xff, 0xf9, 0xf9, 0x3f, 0xf3, 0x33,
    0xff, 0xff, 0xff, 0xff, 0xff, 0x9f, 0xff, 0x31, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x31, 0xff, 0xf9, 0xff,
    0xff, 0xff, 0xff, 0xff, 0x1f, 0xff, 0x9f, 0x9f, 0xff, 0xff, 0xf9, 0xff, 0xff, 0xff, 0xf9, 0xff, 0x9f, 0xff, 0x9f,
    0x9f, 0xff, 0xff, 0xff, 0xf9, 0xf9, 0xff, 0xf9, 0xff, 0xff, 0xff, 0xff, 0xff, 0x9f};
unsigned char floor2[] = {
    0xff, 0xff, 0x9f, 0xff, 0xff, 0xff, 0xff, 0x9f, 0xff, 0xf9, 0xf9, 0xff, 0xff, 0xff, 0xf9, 0xf9, 0xff, 0xff, 0x9f,
    0xff, 0xff, 0xff, 0xff, 0x9f, 0xff, 0xff, 0xff, 0xff, 0xf9, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x9f, 0x9f,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf9, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf9, 0x9f,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x9f, 0xff, 0x9f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf9, 0xf9, 0xf9, 0xff, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xff, 0x9f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf9, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x9f, 0x9f, 0xff, 0xff, 0xf9, 0xff, 0xff, 0xff, 0xf9, 0xff, 0x9f, 0xff, 0x9f,
    0x9f, 0xff, 0xff, 0xff, 0xf9, 0xf9, 0xff, 0xf9, 0xff, 0xff, 0xff, 0xff, 0xff, 0x9f};
unsigned char wall1[] = {
    0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0xcc, 0x1c, 0x11, 0x11, 0x11, 0x11, 0x11, 0xc1, 0xcc, 0xc1, 0x9c,
    0xc1, 0x1c, 0xc1, 0xc9, 0xcc, 0xcc, 0xcc, 0x9c, 0xcc, 0xcc, 0xcc, 0x19, 0xcc, 0xcc, 0xcc, 0x9c, 0xcc, 0xcc, 0xcc,
    0xc9, 0xcc, 0xcc, 0xcc, 0x9c, 0xcc, 0xcc, 0xcc, 0xc9, 0xcc, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0xcc,
    0xcc, 0x1c, 0x1c, 0x9c, 0xcc, 0x1c, 0x19, 0xcc, 0xcc, 0xc1, 0xc1, 0x9c, 0xcc, 0xc1, 0xc9, 0xcc, 0xcc, 0xcc, 0x1c,
    0x9c, 0xcc, 0xcc, 0x19, 0xcc, 0xcc, 0xcc, 0xcc, 0x9c, 0xcc, 0xcc, 0xc9, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99,
    0x99, 0xc1, 0xc9, 0xcc, 0xcc, 0xc1, 0xc1, 0x9c, 0xcc, 0xcc, 0x19, 0xcc, 0xcc, 0xcc, 0x1c, 0x9c, 0xcc, 0xcc, 0xc9,
    0xcc, 0xcc, 0xcc, 0xc1, 0x9c, 0xcc, 0xcc, 0xc9, 0xcc, 0xcc, 0xcc, 0xcc, 0x9c, 0xcc};

// 20 x 8
unsigned char level0[] = {
    2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0,
    0, 0, 0, 0, 3, 3, 3, 3, 0, 0, 0, 3, 3, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 3, 0, 0, 2, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 1, 2, 1, 1, 1, 1, 1,
    2, 2, 1, 1, 1, 1, 2, 2, 2, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
};

void game_main() {
    loadImage(floor1, 1000, sizeof(floor1));
    loadImage(floor2, 1000 + 128, sizeof(floor2));
    loadImage(wall1, 1000 + 256, sizeof(wall1));

    loadImage(person_data, 3000, sizeof(person_data));
    loadImage(bg_data, 7000, sizeof(bg_data));
    loadImage(person_run_data, 30000, sizeof(person_run_data));

    Sprite sprite = {
        .address       = 3000,
        .imageh        = 32,
        .imagew        = person_width,
        .left          = 5,
        .right         = person_width - 10,
        .top           = 0,
        .bottom        = 32,
        .collision     = 3,
        .x             = 50,
        .y             = 10,
        .accelerationy = 1,
        .framelen      = 6,
        .framerate     = 4,
    };

    TileMap tilemap = {.address   = 1000,
                       .mapw      = 20,
                       .maph      = 8,
                       .map       = level0,
                       .collision = level0,
                       .imageh    = 16,
                       .imagew    = 16,
                       .x         = 0,
                       .y         = 0};

    Background bg = {
        .x       = 0,
        .y       = 0,
        .address = 7000,
        .imageh  = bg_height,
        .imagew  = bg_width,
    };

    loadBackground(&bg);
    loadTileMap(&tilemap);
    loadSprite(&sprite);

    setFramerate(25);
    while (1) {
        unsigned char key = getKey();

        if (key & KEY_RIGHT) {
            sprite.speedx = 2;
            sprite.address = 30000;
            sprite.framelen = 8;
        } else if (key & KEY_LEFT)
            sprite.speedx = -2;
        else{
            sprite.speedx = 0;
            sprite.address = 3000;
            sprite.framelen = 6;
        }

        if (key & KEY_UP)
            sprite.speedy = -5;

        gameTick();

        screenRoll(-sprite.speedx, 0);
    }
}
